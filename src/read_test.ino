#ifdef TEST
String testTelegram = R""""(
/ESO5\253880853_A
0-0:1.0.0(231030174109W)
1-0:1.8.0(00002168.313*kWh)
1-0:3.8.0(00000135.946*kvarh)
1-0:4.8.0(00001457.806*kvarh)
1-0:1.8.1(00000901.998*kWh)
1-0:1.8.2(00001266.315*kWh)
1-0:1.8.3(00000000.000*kWh)
1-0:1.8.4(00000000.000*kWh)
1-0:2.8.1(00005240.589*kWh)
1-0:2.8.2(00002078.629*kWh)
1-0:2.8.3(00000000.000*kWh)
1-0:2.8.4(00000000.000*kWh)
1-0:3.8.1(00000069.426*kvarh)
1-0:3.8.2(00000066.520*kvarh)
1-0:3.8.3(00000000.000*kvarh)
1-0:3.8.4(00000000.000*kvarh)
1-0:4.8.1(00000655.658*kvarh)
1-0:4.8.2(00000802.148*kvarh)
1-0:4.8.3(00000000.000*kvarh)
1-0:4.8.4(00000000.000*kvarh)
1-0:32.7.0(0000.230*kV)
1-0:32.24.0(0000.229*kV)
1-0:31.7.0(0000.000*kA)
1-0:31.4.0(0000.000*kA)
1-0:52.7.0(0000.227*kV)
1-0:52.24.0(0000.226*kV)
1-0:51.7.0(0000.000*kA)
1-0:51.4.0(0000.000*kA)
1-0:72.7.0(0000.228*kV)
1-0:72.24.0(0000.227*kV)
1-0:71.7.0(0000.003*kA)
1-0:71.4.0(0000.000*kA)
1-0:12.7.0(0000.230*kV)
1-0:11.7.0(0000.003*kA)
1-0:91.7.0(0000.000*kA)
1-0:90.7.0(0000.003*kA)
1-0:14.7.0(0000.050*kHz)
1-0:15.7.0(00000000.742*kW)
1-0:21.7.0(00000000.020*kW)
1-0:41.7.0(00000000.142*kW)
1-0:61.7.0(00000000.579*kW)
1-0:22.7.0(00000000.000*kW)
1-0:42.7.0(00000000.000*kW)
1-0:62.7.0(00000000.000*kW)
1-0:23.7.0(00000000.000*kvar)
1-0:43.7.0(00000000.000*kvar)
1-0:24.7.0(00000000.013*kvar)
1-0:44.7.0(00000000.053*kvar)
1-0:64.7.0(00000000.250*kvar)
1-0:9.7.0(00000000.890*kVA)
1-0:29.7.0(00000000.024*kVA)
1-0:49.7.0(00000000.166*kVA)
1-0:10.7.0(00000000.000*kVA)
1-0:30.7.0(00000000.000*kVA)
1-0:50.7.0(00000000.000*kVA)
1-0:70.7.0(00000000.000*kVA)
1-0:1.24.0(00000000.090*kW)
1-0:16.24.0(00000000.008*kW)
1-0:15.24.0(00000000.733*kW)
1-0:13.7.0(00919)
1-0:33.7.0(00667)
1-0:53.7.0(00857)
1-0:73.7.0(00827)
1-0:13.3.0(00000)
1-0:0.8.2(00900*s)
1-0:1.4.0(00000000.586*kW)
1-0:2.4.0(00000000.000*kW)
1-0:3.4.0(00000000.000*kvar)
1-0:4.4.0(00000000.235*kvar)
1-0:9.4.0(00000000.696*kVA)
1-0:10.4.0(00000000.000*kVA)
1-0:1.5.0(00000000.678*kW)
1-0:2.5.0(00000000.000*kW)
1-0:3.5.0(00000000.005*kvar)
1-0:4.5.0(00000000.335*kvar)
1-0:9.5.0(00000000.909*kVA)
1-0:10.5.0(00000000.000*kVA)
0-0:96.7.21(00032)
1-0:32.33.0(04880*s)
1-0:52.33.0(04880*s)
1-0:72.33.0(04880*s)
1-0:32.34.0(00000*V)
1-0:52.34.0(00000*V)
1-0:72.34.0(00000*V)
1-0:32.37.0(00000*s)
1-0:52.37.0(00000*s)
1-0:72.37.0(00000*s)
1-0:32.38.0(00000*V)
1-0:52.38.0(00000*V)
1-0:72.38.0(00000*V)
1-0:0.2.0(02.21)
1-0:0.2.8(1EA43311)
1-1:0.2.0(01.97)
1-1:0.2.8(68860C25)
!C471
)"""";

bool readTestSerial() {
  int _index = 1;
  while (true) {
      String _line = getTestLine(testTelegram, '\n', _index);
      if (_line.isEmpty()) {
         return true;
      }
      int _len = _line.length();
      strcpy(telegram, _line.c_str());
      telegram[_len] = '\n';
      telegram[_len + 1] = 0;

      bool result = decodeTelegram(_len + 2);
      _index++;   
  }
}

String getTestLine(String data, char separator, int index) {
  int _found = 0;
  int _strIndex[] = {
    0, -1  };
  int _maxIndex = data.length()-1;
  for(int i=0; i<=_maxIndex && _found<=index; i++){
    if(data.charAt(i) == separator || i == _maxIndex) {
      _found++;
      _strIndex[0] = _strIndex[1]+1;
      _strIndex[1] = (i == _maxIndex) ? i+1 : i;
    }
  }
  return _found > index ? data.substring(_strIndex[0], _strIndex[1]) : "";
}
#endif